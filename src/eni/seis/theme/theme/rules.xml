<?xml version="1.0" encoding="UTF-8"?>
<rules
  xmlns="http://namespaces.plone.org/diazo"
  xmlns:css="http://namespaces.plone.org/diazo/css"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:xi="http://www.w3.org/2001/XInclude">


  <notheme css:if-not-content="body.userrole-anonymous" />

  <xi:include href="rules/admin.xml" />
  <xi:include href="rules/homepage.xml" />

  <!-- Folder view -->
  <rules css:if-content="body.template-folder_listing.portaltype-folder">
    <drop css:theme=".page-aside .box.newsletter-box" />
    <drop css:theme=".page-aside .box.leading-large" />
  </rules>

  <!-- Document view, simple page view -->
  <rules css:if-content="body.template-document_view.portaltype-document">
    <drop css:theme=".page-aside .box.newsletter-box" />
    <drop css:theme=".page-aside .box.leading-large" />
  </rules>

  <!-- Nav -->
  <replace css:theme=".page-aside .nav.nav-folder">
    <nav class="nav nav-folder">
      <header class="nav-header">
        <h4 class="nav-title">Nav</h4>
      </header>
      <div class="nav-body">
        <xsl:for-each css:select="dl.portlet.portletNavigationTree > dd.portletItem > ul.navTree.navTreeLevel0 > li.navTreeItem">
          <xsl:value-of select="li"/>
          <div class="nav-group">
            <ul class="nav-items">
              <li class="nav-item">
                <xsl:copy-of select="a"/>
                <xsl:for-each select="./ul">
                  <ul class="nav-items">
                    <xsl:for-each select="./li">
                      <li class="nav-item">
                        <xsl:copy-of select="a"/>
                      </li>
                    </xsl:for-each>
                  </ul>
                </xsl:for-each>
              </li>
            </ul>
          </div>
        </xsl:for-each>
      </div>
    </nav>
  </replace>

  <!-- Apply the following rules to standard Plone pages -->
  <rules css:if-content="#visual-portal-wrapper">

    <theme href="index.html" />

    <!-- Replace title with Plone's page title  -->
    <replace
      css:content="html head title"
      css:theme="html head title"
      />

    <!-- Copy base tag from Plone -->
    <before
      css:content="html head base"
      css:theme-children="html head"
      />

    <!-- Copy link, style, meta tags from Plone head -->
    <before
      content="/html/head/link | /html/head/style | /html/head/meta"
      css:theme-children="html head"
      />

    <!-- merge classes from Plone body with theme body -->
    <merge
      attributes="class"
      css:content="body"
      css:theme="body"
      />

    <!-- Copy script tags from Plone head to end of body -->
    <after
      css:content="html head script"
      css:theme-children="html body"
      />

    <!-- LOGO -->
    <copy
      attributes="href"
      css:content="#portal-logo"
      css:theme=".navbar-brand"
      />

    <!-- PORTAL NAVIGATION -->
    <replace
      css:content="#portal-globalnav"
      css:theme="#navbar .navbar-menu"
      />

    <!-- LOGIN (FOR ANONYMOUS USERS) -->
    <replace
      if-content="//li[@id='anon-personalbar']"
      css:content="#personaltools-login"
      css:theme=".dropdown-toggle"
      />

    <!-- USER NAME (FOR LOGGED-IN USERS) -->
    <replace
      if-content="not(//li[@id='anon-personalbar'])"
      content="//a[@id='user-name']/text()"
      css:theme="#user-name"
      />

    <!-- USER ACTIONS (FOR LOGGED-IN USERS) -->
    <replace
      if-content="not(//li[@id='anon-personalbar'])"
      css:content-children="#portal-personaltools .actionMenuContent ul"
      css:theme-children="#action-menu-content"
      />

    <!-- BREADCRUMBS -->
    <replace
      css:content="#portal-breadcrumbs"
      css:theme=".breadcrumbs"
      />
    <drop css:content="span#breadcrumbs-you-are-here" />

    <!-- copy current workflow state into the -->
    <replace
      css:content="#plone-contentmenu-workflow .actionMenuHeader a span"
      css:theme="#currentWorkflowState"
      />
    <!-- drop Plone dropdown arrow -->
    <drop
      css:content="#plone-contentmenu-workflow .arrowDownAlternative"
      />

    <!-- 
      #viewlet-above-content-title 
      for portalMessages
    -->

    <!-- Page header -->
    <replace
      css:content-children=".documentFirstHeading"
      css:theme-children=".page-title"
      />

    <replace
      css:content-children=".documentDescription"
      css:theme-children=".page-description"
      />

    <!--
      #viewlet-below-content-title
      for author, date, history
    -->

    <!-- 
      #viewlet-above-content-body
    -->

    <!-- main content -->
    <replace
      css:content-children="#content-core"
      css:theme-children=".page-main"
      />

    <!-- 
      #viewlet-below-content-body
      #viewlet-below-content
        .documentActions
        #socialmedia-viewlet
    -->

    <!-- FOOTER -->
    <replace
      css:content="#portal-siteactions"
      css:theme="#diazo-portal-siteactions"
      />

  </rules>

</rules>
